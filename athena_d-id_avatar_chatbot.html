<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena AI Avatar Chat - D-ID Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 25%, #312e81 50%, #5b21b6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Main Container */
        .chatbot-main {
            width: 100%;
            max-width: 1100px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 600px;
        }

        /* Left Side - Avatar */
        .avatar-panel {
            background: linear-gradient(135deg, #c41e3a 0%, #a62d2d 100%);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .avatar-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .avatar-wrapper {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .avatar-image-container {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: avatarPulse 2.5s ease-in-out infinite;
        }

        @keyframes avatarPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            }
            50% { 
                transform: scale(1.03);
                box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            }
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .avatar-status-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: #4ade80;
            border: 3px solid white;
            border-radius: 50%;
            animation: statusPulse 2s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes statusPulse {
            0%, 100% { box-shadow: 0 0 10px #4ade80, inset 0 0 0 0 rgba(74, 222, 128, 0.5); }
            50% { box-shadow: 0 0 20px #4ade80, inset 0 0 0 2px rgba(74, 222, 128, 0.3); }
        }

        .avatar-info {
            text-align: center;
            color: white;
            z-index: 2;
        }

        .avatar-name {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: -0.5px;
        }

        .avatar-title {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-bottom: 5px;
        }

        .avatar-status-text {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .voice-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            z-index: 2;
        }

        .voice-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .voice-btn.active {
            background: white;
            color: #c41e3a;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Right Side - Chat */
        .chat-panel {
            display: flex;
            flex-direction: column;
            background: #f8fafc;
            padding: 0;
        }

        .chat-header {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .chat-header-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mode-toggle {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px;
            border-radius: 8px;
        }

        .mode-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #1e40af;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #fff;
        }

        .message {
            display: flex;
            animation: slideIn 0.3s ease;
            gap: 10px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bot .message-content {
            background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
            color: #1e40af;
            border-left: 3px solid #3b82f6;
        }

        .user .message-content {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-radius: 12px;
        }

        .message-text {
            flex: 1;
        }

        .message-voice-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .message-voice-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.15);
        }

        .message-voice-btn.playing {
            animation: audioPlay 1s ease-in-out infinite;
        }

        @keyframes audioPlay {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: flex-end;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(-10px); }
        }

        /* Input Section */
        .input-section {
            padding: 20px 30px;
            border-top: 2px solid #e2e8f0;
            background: white;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
            background: white;
        }

        .message-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .message-input::placeholder {
            color: #9ca3af;
        }

        .input-action-btn {
            width: 42px;
            height: 42px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #c41e3a, #a62d2d);
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .input-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3);
        }

        .input-action-btn:active {
            transform: scale(0.95);
        }

        .input-action-btn.recording {
            background: #ef4444;
            animation: recordingPulse 1.5s ease-in-out infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0.2); }
        }

        /* Scrollbar */
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .chatbot-main {
                grid-template-columns: 1fr;
                height: auto;
                min-height: 600px;
            }

            .avatar-panel {
                padding: 30px 20px;
                min-height: 350px;
            }

            .avatar-image-container {
                width: 150px;
                height: 150px;
            }

            .avatar-name {
                font-size: 22px;
            }

            .chat-panel {
                height: 350px;
            }

            .message-content {
                max-width: 90%;
            }
        }

        .welcome-message {
            text-align: center;
            color: #999;
            padding: 20px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="chatbot-main">
        <!-- Left Panel - Avatar -->
        <div class="avatar-panel">
            <div class="avatar-wrapper">
                <div class="avatar-image-container">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='skinGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f4d4c8;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23e8c4b8;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='200' height='200' fill='url(%23skinGrad)'/%3E%3Ccircle cx='100' cy='60' r='45' fill='%23dab5a3'/%3E%3Crect x='55' y='95' width='90' height='100' rx='20' fill='%236b8cce'/%3E%3Ccircle cx='75' cy='55' r='6' fill='%23333'/%3E%3Ccircle cx='125' cy='55' r='6' fill='%23333'/%3E%3Cpath d='M 75 65 Q 100 75 125 65' stroke='%23333' stroke-width='2' fill='none'/%3E%3Cpath d='M 85 85 L 85 95' stroke='%23333' stroke-width='1.5' fill='none'/%3E%3Cpath d='M 115 85 L 115 95' stroke='%23333' stroke-width='1.5' fill='none'/%3E%3C/svg%3E" alt="Ambassador Paul" class="avatar-image">
                    <div class="avatar-status-badge"></div>
                </div>

                <div class="avatar-info">
                    <div class="avatar-name">Ambassador Paul</div>
                    <div class="avatar-title">AI Learning Assistant</div>
                    <div class="avatar-status-text">
                        <span class="status-dot"></span>
                        <span>Ready to help</span>
                    </div>
                </div>

                <div class="voice-controls">
                    <button class="voice-btn" id="muteBtn" title="Mute Avatar">üîá</button>
                    <button class="voice-btn" id="speakerBtn" title="Speaker">üîä</button>
                    <button class="voice-btn" id="micBtn" title="Microphone">üé§</button>
                </div>
            </div>
        </div>

        <!-- Right Panel - Chat -->
        <div class="chat-panel">
            <!-- Header -->
            <div class="chat-header">
                <div class="chat-header-title">
                    <span>üí¨ Chat with Paul</span>
                </div>
                <div class="mode-toggle">
                    <button class="mode-btn active" onclick="setMode('auto')">ü§ñ Auto</button>
                    <button class="mode-btn" onclick="setMode('manual')">‚å®Ô∏è Manual</button>
                </div>
            </div>

            <!-- Messages -->
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    üëã Say hello to Ambassador Paul!<br>
                    Click the microphone to speak or type your message.
                </div>
            </div>

            <!-- Input -->
            <div class="input-section">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Type or speak..."
                        autocomplete="off"
                    >
                    <button class="input-action-btn" id="sendBtn" title="Send">‚û§</button>
                </div>
                <button class="input-action-btn" id="recordBtn" title="Record Voice">üé§</button>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const recordBtn = document.getElementById('recordBtn');
        const micBtn = document.getElementById('micBtn');
        const muteBtn = document.getElementById('muteBtn');
        const speakerBtn = document.getElementById('speakerBtn');

        // Web Speech API
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        const synth = window.speechSynthesis;

        let isListening = false;
        let isSpeaking = false;
        let isMuted = false;
        let autoMode = true;
        let isRecording = false;

        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        // Send Message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            messageInput.value = '';
            addMessage(text, 'user');

            // Simulate bot thinking
            showTypingIndicator();

            setTimeout(() => {
                removeTypingIndicator();
                const responses = [
                    'That\'s a great question! Let me help you with that.',
                    'I understand. Here\'s what I can tell you about that.',
                    'Excellent! I\'m here to assist you with any questions.',
                    'Thank you for asking. Let me provide you with more details.',
                    'I appreciate your interest. Here\'s the information you need:'
                ];
                const botResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(botResponse, 'bot');
                
                if (autoMode && !isMuted) {
                    speakMessage(botResponse);
                }
            }, 1000);
        }

        // Add Message to Chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const voiceBtnHtml = sender === 'bot' ? `<button class="message-voice-btn" onclick="playMessageVoice(this, '${text.replace(/'/g, "\\'")}')">üîä</button>` : '';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <span class="message-text">${escapeHtml(text)}</span>
                    ${voiceBtnHtml}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Play Message Voice
        function playMessageVoice(btn, text) {
            if (synth.speaking) synth.cancel();
            btn.classList.add('playing');
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1;
            utterance.pitch = 1.1;
            utterance.volume = 1;

            utterance.onend = () => {
                btn.classList.remove('playing');
            };

            synth.speak(utterance);
        }

        // Speak Message
        function speakMessage(text) {
            if (isMuted) return;
            if (isSpeaking) synth.cancel();
            
            isSpeaking = true;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1;
            utterance.pitch = 1.1;
            utterance.volume = 1;

            utterance.onend = () => {
                isSpeaking = false;
            };

            synth.speak(utterance);
        }

        // Typing Indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // Set Mode
        function setMode(mode) {
            autoMode = mode === 'auto';
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Mute/Unmute
        muteBtn.addEventListener('click', () => {
            isMuted = !isMuted;
            muteBtn.style.background = isMuted ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.2)';
            muteBtn.textContent = isMuted ? 'üîá' : 'üîâ';
        });

        // Speaker
        speakerBtn.addEventListener('click', () => {
            if (!messagesContainer.querySelector('.message.bot')) {
                addMessage('No messages to speak yet.', 'bot');
            }
        });

        // Microphone and Recording
        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                startListening();
            } else {
                stopListening();
            }
        });

        micBtn.addEventListener('click', () => {
            if (!isRecording) {
                startListening();
            } else {
                stopListening();
            }
        });

        function startListening() {
            isRecording = true;
            recordBtn.classList.add('recording');
            micBtn.classList.add('active');
            recognition.start();
        }

        function stopListening() {
            isRecording = false;
            recordBtn.classList.remove('recording');
            micBtn.classList.remove('active');
            recognition.stop();
        }

        recognition.onresult = (event) => {
            let transcript = '';
            for (let i = event.resultIndex; i < event.results.length; i++) {
                transcript += event.results[i][0].transcript;
            }
            messageInput.value = transcript;

            if (event.results[0].isFinal) {
                stopListening();
                setTimeout(sendMessage, 300);
            }
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            stopListening();
        };

        recognition.onend = () => {
            isRecording = false;
            recordBtn.classList.remove('recording');
            micBtn.classList.remove('active');
        };

        // Send Button
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
    </script>
</body>
</html>
