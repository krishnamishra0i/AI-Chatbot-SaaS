<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena LMS - AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Chatbot Container */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }

        /* Chat Window */
        .chat-window {
            width: 420px;
            height: 680px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header */
        .chat-header {
            background: linear-gradient(135deg, #a62d2d 0%, #c41e3a 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .chat-header-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .minimize-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            margin-right: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .minimize-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Avatar Section */
        .avatar-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .avatar.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 0 0 10px rgba(102, 126, 234, 0);
            }
        }

        .avatar-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .avatar-status {
            font-size: 12px;
            color: #718096;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
            margin-right: 6px;
        }

        /* Messages Section */
        .messages-section {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .message.bot .message-content {
            background: #f0f2f5;
            color: #2d3748;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #a62d2d 0%, #c41e3a 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 4px;
            padding: 0 4px;
        }

        /* Input Section */
        .input-section {
            border-top: 1px solid #e2e8f0;
            padding: 16px;
            background: white;
        }

        .input-group {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            border: 2px solid #e2e8f0;
            border-radius: 24px;
            padding: 8px 16px;
            transition: border-color 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: #a62d2d;
        }

        .text-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            padding: 8px 0;
            font-family: inherit;
        }

        .text-input::placeholder {
            color: #cbd5e0;
        }

        .mic-btn {
            background: none;
            border: none;
            color: #a0aec0;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mic-btn:hover {
            color: #a62d2d;
        }

        .mic-btn.recording {
            color: #f56565;
            animation: micPulse 1s infinite;
        }

        @keyframes micPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .send-btn {
            background: linear-gradient(135deg, #a62d2d 0%, #c41e3a 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(166, 45, 45, 0.4);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Floating Button */
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a62d2d 0%, #c41e3a 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(166, 45, 45, 0.4);
        }

        .floating-btn:active {
            transform: scale(0.95);
        }

        /* Hidden Class */
        .hidden {
            display: none !important;
        }

        /* Scrollbar Styling */
        .messages-section::-webkit-scrollbar {
            width: 6px;
        }

        .messages-section::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-section::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }

        .messages-section::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #cbd5e0;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.5;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-8px);
            }
        }

        /* Voice Mode Indicator */
        .voice-mode-indicator {
            background: linear-gradient(90deg, #f56565, #fc8181);
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 8px;
            text-align: center;
            animation: fadeIn 0.3s ease-out;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .chat-window {
                width: 100%;
                height: 100vh;
                border-radius: 0;
                max-width: 100%;
            }

            .chatbot-container {
                bottom: 0;
                right: 0;
                left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Chatbot Container -->
    <div class="chatbot-container">
        <!-- Floating Button (shown when chat is closed) -->
        <button class="floating-btn" id="floatingBtn" title="Chat with Athena AI">
            ðŸ’¬
        </button>

        <!-- Chat Window -->
        <div class="chat-window hidden" id="chatWindow">
            <!-- Header -->
            <div class="chat-header">
                <div>
                    <h2>Athena AI</h2>
                    <div class="chat-header-subtitle">Always here to help</div>
                </div>
                <div>
                    <button class="minimize-btn" id="minimizeBtn" title="Minimize">âˆ’</button>
                    <button class="close-btn" id="closeBtn" title="Close">âœ•</button>
                </div>
            </div>

            <!-- Avatar Section -->
            <div class="avatar-section">
                <div class="avatar" id="avatar">ðŸ¤–</div>
                <div class="avatar-name">Athena Assistant</div>
                <div class="avatar-status">
                    <span class="status-indicator"></span>
                    <span id="statusText">Ready to help</span>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="messages-section" id="messagesSection">
                <div class="message bot">
                    <div>
                        <div class="message-content">
                            ðŸ‘‹ Welcome! I'm your AI learning assistant. How can I help you today?
                        </div>
                        <div class="message-time">just now</div>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div id="voiceModeIndicator" class="voice-mode-indicator hidden">
                    ðŸŽ¤ Listening... Speak now
                </div>
                <div class="input-group">
                    <div class="input-wrapper">
                        <input 
                            type="text" 
                            class="text-input" 
                            id="messageInput" 
                            placeholder="Type your question..."
                            autocomplete="off"
                        >
                        <button class="mic-btn" id="micBtn" title="Voice input (Click and speak)">
                            ðŸŽ¤
                        </button>
                    </div>
                    <button class="send-btn" id="sendBtn" title="Send message">
                        âž¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const floatingBtn = document.getElementById('floatingBtn');
        const chatWindow = document.getElementById('chatWindow');
        const closeBtn = document.getElementById('closeBtn');
        const minimizeBtn = document.getElementById('minimizeBtn');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const micBtn = document.getElementById('micBtn');
        const messagesSection = document.getElementById('messagesSection');
        const avatar = document.getElementById('avatar');
        const statusText = document.getElementById('statusText');
        const voiceModeIndicator = document.getElementById('voiceModeIndicator');

        // Variables
        let isRecording = false;
        let recognitionInProgress = false;
        const recognition = window.webkitSpeechRecognition ? new webkitSpeechRecognition() : null;
        const synth = window.speechSynthesis;

        // Speech Recognition Setup
        if (recognition) {
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isRecording = true;
                recognitionInProgress = true;
                micBtn.classList.add('recording');
                avatar.classList.add('listening');
                voiceModeIndicator.classList.remove('hidden');
                statusText.textContent = 'Listening...';
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i].transcript;
                    if (event.results[i].isFinal) {
                        messageInput.value += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                if (interimTranscript) {
                    messageInput.value = messageInput.value.split(' ').slice(0, -1).join(' ') + ' ' + interimTranscript;
                }
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                avatar.classList.remove('listening');
                voiceModeIndicator.classList.add('hidden');
                statusText.textContent = 'Ready to help';
                if (messageInput.value.trim()) {
                    sendMessage();
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                statusText.textContent = 'Listening error';
                voiceModeIndicator.classList.add('hidden');
            };
        }

        // Event Listeners
        floatingBtn.addEventListener('click', () => {
            chatWindow.classList.remove('hidden');
            floatingBtn.classList.add('hidden');
            messageInput.focus();
        });

        closeBtn.addEventListener('click', () => {
            chatWindow.classList.add('hidden');
            floatingBtn.classList.remove('hidden');
            if (isRecording) {
                recognition.abort();
            }
        });

        minimizeBtn.addEventListener('click', () => {
            chatWindow.classList.add('hidden');
            floatingBtn.classList.remove('hidden');
            if (isRecording) {
                recognition.abort();
            }
        });

        micBtn.addEventListener('click', () => {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser. Please use Chrome, Edge, or Safari.');
                return;
            }
            if (isRecording) {
                recognition.abort();
            } else {
                messageInput.value = '';
                recognition.start();
            }
        });

        sendBtn.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Send Message Function
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Simulate API call (replace with your actual backend endpoint)
            setTimeout(() => {
                removeTypingIndicator();
                const response = getResponse(message);
                addMessage(response, 'bot');
                speakMessage(response);
            }, 1000 + Math.random() * 1000);
        }

        // Add Message to Chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

            messageDiv.innerHTML = `
                <div>
                    <div class="message-content">${escapeHtml(text)}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;

            messagesSection.appendChild(messageDiv);
            messagesSection.scrollTop = messagesSection.scrollHeight;
        }

        // Show Typing Indicator
        function showTypingIndicator() {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'bot');
            messageDiv.id = 'typingIndicator';
            messageDiv.innerHTML = `
                <div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            messagesSection.appendChild(messageDiv);
            messagesSection.scrollTop = messagesSection.scrollHeight;
        }

        // Remove Typing Indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Get Response (Replace with API call)
        function getResponse(message) {
            const responses = [
                "I understand your question about courses and learning paths. Let me help you find the right resources.",
                "That's a great question! Based on your learning goals, I'd recommend exploring our course catalog.",
                "I'm here to assist you. Would you like information about specific courses or learning programs?",
                "Thanks for asking! I'm constantly learning to better assist you with your educational needs.",
                "I can help you navigate our learning management system. What would you like to explore?"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Text-to-Speech Function
        function speakMessage(text) {
            if (!synth) return;

            synth.cancel(); // Cancel any ongoing speech

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1;
            utterance.pitch = 1;
            utterance.volume = 1;

            utterance.onstart = () => {
                avatar.textContent = 'ðŸŽ§';
                statusText.textContent = 'Speaking...';
            };

            utterance.onend = () => {
                avatar.textContent = 'ðŸ¤–';
                statusText.textContent = 'Ready to help';
            };

            synth.speak(utterance);
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        messageInput.focus();
    </script>
</body>
</html>
