<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena - Enterprise AI Avatar Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --brand-1: #667eea;
            --brand-2: #764ba2;
            --brand-3: #4f46e5;
            --bg: #f6f7fb;
            --surface: #ffffff;
            --surface-2: rgba(255, 255, 255, 0.85);
            --text: #111827;
            --muted: #6b7280;
            --border: rgba(17, 24, 39, 0.10);
            --shadow-sm: 0 6px 20px rgba(17, 24, 39, 0.08);
            --shadow-md: 0 18px 55px rgba(17, 24, 39, 0.12);
            --radius: 16px;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text);
            line-height: 1.6;
            background:
                radial-gradient(1200px 700px at 10% -10%, rgba(102, 126, 234, 0.18), transparent 55%),
                radial-gradient(900px 600px at 95% 10%, rgba(118, 75, 162, 0.16), transparent 55%),
                var(--bg);
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--surface-2);
            backdrop-filter: blur(10px);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 12px 40px rgba(17, 24, 39, 0.06);
            z-index: 1000;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--muted);
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--brand-1);
        }

        .cta-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 10px 24px rgba(102, 126, 234, 0.22);
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        main {
            margin-top: 70px;
        }

        /* Hero Section */
        .hero {
            background:
                radial-gradient(1200px 700px at 20% 0%, rgba(255, 255, 255, 0.22), transparent 55%),
                linear-gradient(135deg, var(--brand-1) 0%, var(--brand-2) 100%);
            color: white;
            padding: 100px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 56px;
            margin-bottom: 20px;
            font-weight: 800;
            line-height: 1.2;
            letter-spacing: -1px;
        }

        .hero p {
            font-size: 20px;
            opacity: 0.95;
            margin-bottom: 40px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.92);
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            padding: 15px 40px;
            background: white;
            color: var(--brand-3);
            border: none;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            box-shadow: 0 16px 45px rgba(17, 24, 39, 0.16);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            padding: 15px 40px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            backdrop-filter: blur(8px);
        }

        .btn-secondary:hover {
            background: white;
            color: var(--brand-3);
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            padding: 80px 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.92);
            padding: 35px;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-md);
            border-color: rgba(102, 126, 234, 0.35);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            font-size: 22px;
            margin-bottom: 12px;
            color: var(--text);
        }

        .feature-card p {
            color: var(--muted);
            font-size: 15px;
            line-height: 1.6;
        }

        /* Use Cases Section */
        .use-cases {
            background: white;
            padding: 80px 40px;
        }

        .section-title {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: -0.9px;
        }

        .testimonials .section-title {
            background: none;
            -webkit-text-fill-color: #ffffff;
            color: #ffffff;
        }

        .section-subtitle {
            text-align: center;
            color: var(--muted);
            font-size: 18px;
            margin-bottom: 60px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .use-cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .use-case-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.15);
            transition: all 0.3s;
            cursor: pointer;
        }

        .use-case-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .use-case-icon {
            font-size: 36px;
            margin-bottom: 15px;
        }

        .use-case-item h4 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
            font-weight: 700;
        }

        .use-case-item p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Integrations Section */
        .integrations {
            background: linear-gradient(135deg, #f5f7fa, #e8ecff);
            padding: 80px 40px;
        }

        .integrations-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }

        .integrations-text h2 {
            font-size: 48px;
            margin-bottom: 30px;
            color: #333;
            font-weight: 800;
        }

        .integrations-text p {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .integration-logos {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .integration-logo {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
            font-weight: 700;
            color: #667eea;
            transition: all 0.3s;
        }

        .integration-logo:hover {
            border-color: #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }

        /* Enterprise Features */
        .enterprise-features {
            background: white;
            padding: 80px 40px;
        }

        .enterprise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .enterprise-item {
            text-align: center;
        }

        .enterprise-icon {
            font-size: 56px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .enterprise-item h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 700;
        }

        .enterprise-item p {
            color: #666;
            line-height: 1.7;
            font-size: 15px;
        }

        /* Testimonials */
        .testimonials {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 40px;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .testimonial-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .testimonial-text {
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.8;
            font-style: italic;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .author-avatar {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .author-info h4 {
            font-weight: 700;
            margin-bottom: 3px;
        }

        .author-info p {
            font-size: 13px;
            opacity: 0.9;
        }

        /* FAQ Section */
        .faq {
            background: white;
            padding: 80px 40px;
        }

        .faq-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .faq-item {
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }

        .faq-question {
            padding: 20px;
            background: #f8fafc;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #333;
            transition: all 0.3s;
        }

        .faq-question:hover {
            background: #e8ecff;
            color: #667eea;
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 20px;
            background: white;
            color: #666;
            line-height: 1.8;
        }

        .faq-item.active .faq-answer {
            max-height: 300px;
            padding: 20px;
        }

        .faq-toggle {
            font-size: 20px;
            font-weight: 300;
        }

        .faq-item.active .faq-toggle {
            transform: rotate(180deg);
        }

        /* Floating Chatbot Button */
        .chatbot-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 8px 35px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .chatbot-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 12px 45px rgba(102, 126, 234, 0.6);
        }

        .chatbot-btn:active {
            transform: scale(1.05);
        }

        #chatbotContainer button {
            -webkit-tap-highlight-color: transparent;
        }

        #chatbotContainer button:hover {
            filter: brightness(1.02);
        }

        #chatbotContainer button:active {
            transform: translateY(1px);
        }

        .chat-toolbar {
            display: flex;
            gap: 8px;
            padding: 10px 14px;
            border-top: 1px solid #e5e7eb;
            background: linear-gradient(180deg, rgba(248, 250, 252, 0.9) 0%, rgba(255, 255, 255, 0.95) 100%);
            flex-wrap: wrap;
            align-items: center;
        }

        .chat-chip {
            border: 1px solid rgba(102, 126, 234, 0.22);
            background: rgba(102, 126, 234, 0.08);
            color: #312e81;
            font-size: 12px;
            font-weight: 700;
            padding: 7px 10px;
            border-radius: 999px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .chat-chip:hover {
            background: rgba(102, 126, 234, 0.14);
            transform: translateY(-1px);
        }

        .chat-chip:active {
            transform: translateY(0);
        }

        .bubble-time {
            font-size: 11px;
            margin-top: 8px;
            opacity: 0.8;
        }

        #chatbotContainer {
            --chat-bg: #ffffff;
            --chat-panel: #ffffff;
            --chat-muted: #6b7280;
            --chat-text: #111827;
            --chat-soft: #f8fafc;
            --chat-border: rgba(17, 24, 39, 0.10);
            --chat-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
            --chat-bot-bg: linear-gradient(135deg, #f0f4ff, #f7ebff);
            --chat-bot-text: #312e81;
            --chat-user-bg: linear-gradient(135deg, #667eea, #764ba2);
            --chat-user-text: #ffffff;
        }

        #chatbotContainer.chat-dark {
            --chat-bg: #0b1220;
            --chat-panel: #0f172a;
            --chat-muted: rgba(226, 232, 240, 0.75);
            --chat-text: #e2e8f0;
            --chat-soft: rgba(148, 163, 184, 0.10);
            --chat-border: rgba(226, 232, 240, 0.14);
            --chat-shadow: 0 25px 70px rgba(0, 0, 0, 0.55);
            --chat-bot-bg: linear-gradient(135deg, rgba(102, 126, 234, 0.16), rgba(118, 75, 162, 0.16));
            --chat-bot-text: #e9d5ff;
            --chat-user-bg: linear-gradient(135deg, #667eea, #764ba2);
            --chat-user-text: #ffffff;
        }

        #chatbotContainer .chat-panel-surface {
            background: var(--chat-panel) !important;
        }

        #chatbotContainer .chat-messages-surface {
            background: var(--chat-bg) !important;
        }

        #chatbotContainer .chat-input-surface {
            background: var(--chat-panel) !important;
            border-top: 1px solid var(--chat-border) !important;
        }

        #chatbotContainer .chat-input-wrap {
            background: var(--chat-soft) !important;
            border-color: var(--chat-border) !important;
        }

        #chatbotContainer .chat-input {
            color: var(--chat-text) !important;
        }

        #chatbotContainer .chat-input::placeholder {
            color: rgba(107, 114, 128, 0.9);
        }

        #chatbotContainer.chat-dark .chat-input::placeholder {
            color: rgba(226, 232, 240, 0.6);
        }

        #chatbotContainer .chat-bubble-user {
            background: var(--chat-user-bg) !important;
            color: var(--chat-user-text) !important;
        }

        #chatbotContainer .chat-bubble-bot {
            background: var(--chat-bot-bg) !important;
            color: var(--chat-bot-text) !important;
            border-color: rgba(102, 126, 234, 0.18) !important;
        }

        #chatbotContainer .chat-copy-btn {
            border: 1px solid rgba(102, 126, 234, 0.25);
            background: rgba(102, 126, 234, 0.10);
            color: var(--chat-bot-text);
            border-radius: 10px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #chatbotContainer .chat-copy-btn:hover {
            background: rgba(102, 126, 234, 0.16);
            transform: translateY(-1px);
        }

        #chatbotContainer .chat-copy-btn:active {
            transform: translateY(0);
        }

        /* Chatbot Draggable & Resizable */
        #chatbotContainer {
            cursor: grab !important;
            user-select: auto;
            resize: both;
            overflow: hidden;
            max-width: calc(100vw - 40px);
            max-height: calc(100vh - 140px);
        }

        #chatbotContainer:active {
            cursor: grabbing !important;
        }

        .chatbot-resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, transparent 50%, rgba(102, 126, 234, 0.5) 50%);
            cursor: se-resize;
            border-radius: 0 0 28px 0;
            z-index: 1000;
        }

        /* Responsive Chatbot */
        @media (max-width: 768px) {
            #chatbotContainer {
                width: 100vw !important;
                height: 100vh !important;
                bottom: 0 !important;
                right: 0 !important;
                border-radius: 0 !important;
                left: 0 !important;
                top: 0 !important;
                transform: none !important;
                resize: none !important;
                cursor: default !important;
            }

            #chatbotContainer > div {
                grid-template-columns: 1fr !important;
            }

            .chatbot-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .chatbot-resize-handle {
                display: none;
            }
        }

        /* Support for smaller screens */
        @media (max-width: 480px) {
            #chatbotContainer {
                font-size: 12px;
            }
        }

        /* Footer */
        footer {
            background: #1f2937;
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
            text-align: left;
        }

        .footer-section h4 {
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .footer-section a {
            display: block;
            color: #d1d5db;
            text-decoration: none;
            margin-bottom: 10px;
            font-size: 14px;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: #667eea;
        }

        .footer-bottom {
            border-top: 1px solid #374151;
            padding-top: 30px;
            text-align: center;
            color: #9ca3af;
            font-size: 14px;
        }

        /* Call to Action */
        .cta-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 40px;
            text-align: center;
        }

        .cta-section h2 {
            font-size: 48px;
            margin-bottom: 20px;
            font-weight: 800;
        }

        .cta-section p {
            font-size: 18px;
            margin-bottom: 40px;
            opacity: 0.95;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 36px;
            }

            .section-title {
                font-size: 32px;
            }

            nav {
                flex-direction: column;
                gap: 15px;
            }

            .integrations-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .testimonials-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="logo">üìö Athena Chatbot AI</div>
        <div>
            <button class="cta-btn" onclick="scrollToChat()">Get Started</button>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>The Future of Learning & Communication</h1>
                <p>Enterprise-grade AI avatar platform for real-time interactions with photorealistic avatars powered by advanced voice technology</p>
                <div class="hero-buttons">
                    <button class="btn-primary" onclick="scrollToChat()">Start Chatting Now</button>
                    <button class="btn-secondary">View Documentation</button>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üé§</div>
                <h3>Real-Time Voice Input</h3>
                <p>Speak naturally and let our advanced speech-to-text technology understand your questions instantly</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üîä</div>
                <h3>Natural Voice Output</h3>
                <p>Get intelligent responses spoken with a natural, human-like voice powered by neural technology</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üé≠</div>
                <h3>Photorealistic Avatars</h3>
                <p>Meet lifelike AI avatars that create engaging, face-to-face conversations in real-time</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üåç</div>
                <h3>Multi-Language Support</h3>
                <p>Communicate in any language with seamless translation and localized voice synthesis</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üîê</div>
                <h3>Enterprise Security</h3>
                <p>Bank-level encryption and compliance with GDPR, HIPAA, and other industry standards</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">‚ö°</div>
                <h3>Sub-second Latency</h3>
                <p>Experience near-instantaneous responses for truly interactive conversations</p>
            </div>
        </section>

        <!-- Use Cases Section -->
        <section class="use-cases">
            <h2 class="section-title">Used by Leading Teams</h2>
            <p class="section-subtitle">Athena powers real-time AI interactions across industries</p>
            
            <div class="use-cases-grid">
                <div class="use-case-item">
                    <div class="use-case-icon">üì¢</div>
                    <h4>Marketing</h4>
                    <p>Create personalized video content at scale with AI avatars for viral marketing campaigns</p>
                </div>

                <div class="use-case-item">
                    <div class="use-case-icon">üé¨</div>
                    <h4>Content Creators</h4>
                    <p>Produce professional video content 10x faster with AI avatars speaking any script</p>
                </div>

                <div class="use-case-item">
                    <div class="use-case-icon">üéì</div>
                    <h4>Learning & Development</h4>
                    <p>Create engaging interactive training with AI tutors that respond in real-time</p>
                </div>

                <div class="use-case-item">
                    <div class="use-case-icon">üíº</div>
                    <h4>Sales</h4>
                    <p>Boost conversions with AI sales agents that engage customers 24/7 in their language</p>
                </div>

                <div class="use-case-item">
                    <div class="use-case-icon">üòä</div>
                    <h4>Customer Experience</h4>
                    <p>Deliver personalized customer support with AI avatars handling inquiries intelligently</p>
                </div>

                <div class="use-case-item">
                    <div class="use-case-icon">üíª</div>
                    <h4>Developers</h4>
                    <p>Build next-gen applications with our powerful API and SDKs for any platform</p>
                </div>
            </div>
        </section>

        <!-- Integrations Section -->
        <section class="integrations">
            <div class="integrations-content">
                <div class="integrations-text">
                    <h2>Seamless Integrations</h2>
                    <p>Combine Athena with your favorite tools and platforms to evolve your workflows</p>
                    <p>We integrate with leading platforms including presentation software, design tools, and API-based solutions for maximum flexibility</p>
                </div>
                <div class="integration-logos">
                    <div class="integration-logo">üíª PowerPoint</div>
                    <div class="integration-logo">üé® Canva</div>
                    <div class="integration-logo">üìä Google Slides</div>
                    <div class="integration-logo">üîå API</div>
                    <div class="integration-logo">üì± Mobile Apps</div>
                    <div class="integration-logo">‚òÅÔ∏è Cloud Services</div>
                </div>
            </div>
        </section>

        <!-- Enterprise Features Section -->
        <section class="enterprise-features">
            <h2 class="section-title">Enterprise-Ready</h2>
            <p class="section-subtitle">Built for the highest standards of reliability, security, and support</p>
            
            <div class="enterprise-grid">
                <div class="enterprise-item">
                    <div class="enterprise-icon">üîí</div>
                    <h3>Privacy First</h3>
                    <p>Your data is protected with advanced encryption technology and strict compliance protocols adhering to GDPR, CCPA, and international standards</p>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-icon">üõ°Ô∏è</div>
                    <h3>Security Certified</h3>
                    <p>Multi-layer security infrastructure with SOC 2 Type II certification and continuous penetration testing by leading security experts</p>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-icon">‚öñÔ∏è</div>
                    <h3>Ethical AI</h3>
                    <p>We ensure our products benefit society with responsible AI practices and ethical use clauses built into all terms and conditions</p>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-icon">üéØ</div>
                    <h3>24/7 Support</h3>
                    <p>Dedicated support team available round-the-clock for API customers and Enterprise users with SLA guarantees</p>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-icon">‚öôÔ∏è</div>
                    <h3>99.99% Uptime</h3>
                    <p>Enterprise-grade infrastructure with global redundancy, automatic failover, and disaster recovery protocols</p>
                </div>

                <div class="enterprise-item">
                    <div class="enterprise-icon">üìà</div>
                    <h3>Scalable Architecture</h3>
                    <p>Handle millions of concurrent interactions with auto-scaling infrastructure that grows with your business</p>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials">
            <h2 class="section-title" style="color: white;">What Our Customers Say</h2>
            
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "As a Conversational AI provider, by using Athena we're able to showcase our value proposition of having a live conversation with a generated photorealistic person in real-time using neural voice across different channels"
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">üë®</div>
                        <div class="author-info">
                            <h4>Fernando Moreira</h4>
                            <p>Senior Program Director, Defined AI</p>
                        </div>
                    </div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "The natural user interface transformed how our team creates content. We cut production time by 80% and saw engagement rates increase dramatically"
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">üë©</div>
                        <div class="author-info">
                            <h4>Sarah Chen</h4>
                            <p>Director of Marketing, TechVision Inc</p>
                        </div>
                    </div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "Implementation was seamless and the technical support team was incredibly helpful. We're now serving 100K+ users with Athena powering our customer interactions"
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">üë®</div>
                        <div class="author-info">
                            <h4>James Rodriguez</h4>
                            <p>CTO, Enterprise Solutions Ltd</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <span>What is the Creative Reality Studio?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        The Creative Reality Studio is our powered platform that allows you to create, edit, and publish AI-powered videos with photorealistic avatars. It's designed for content creators, marketers, and enterprises who want to produce professional video content at scale.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>Can I stream the generated video in real-time?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        Yes! Our API supports real-time streaming similar to live chat chatbots. You can integrate our technology into your applications for instantaneous avatar-based interactions with sub-second latency.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What video formats and resolutions do you support?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        We support multiple formats including MP4, WebM, and HLS streaming. Resolution options range from 720p up to 4K, with adaptive bitrate streaming for optimal performance across all devices.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>How do I get an API key?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        Sign up for a developer account on our platform, navigate to the API section, and generate your API key instantly. Our documentation provides comprehensive integration guides for all major platforms and languages.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What are the image upload requirements?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        We accept PNG and JPG formats up to 10MB. For best results, use clear, well-lit headshots with neutral backgrounds. Minimum resolution is 512x512 pixels, with 1024x1024 recommended for optimal quality.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What is the output video length?</span>
                        <span class="faq-toggle">‚ñº</span>
                    </div>
                    <div class="faq-answer">
                        Studio videos can be generated from 15 seconds up to 10 minutes. For streaming and real-time interactions, the duration is unlimited. API users can generate continuous streams for live applications.
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <h2>Ready to Transform Your Communication?</h2>
            <p>Join thousands of enterprise customers using Athena for real-time AI interactions</p>
            <button class="btn-primary" onclick="scrollToChat()">Start Free Trial Today</button>
        </section>
    </main>

    <!-- Floating Chatbot Button -->
    <button class="chatbot-btn" id="chatbotBtn" title="AI Assistant">üí¨</button>

    <!-- Chatbot Modal Container -->
    <div id="chatbotContainer" style="position: fixed; bottom: 100px; right: 30px; width: 520px; height: 600px; display: none; z-index: 998; min-width: 350px;">
        <div style="width: 100%; height: 100%; background: white; border-radius: 28px; box-shadow: var(--chat-shadow); display: grid; grid-template-columns: 1fr 1.2fr; overflow: hidden; border: 1px solid rgba(102, 126, 234, 0.2);">
            <!-- Avatar Panel -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 25px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; min-width: 0;">
                <div style="position: absolute; top: -50%; right: -50%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%); border-radius: 50%; animation: float 6s ease-in-out infinite;"></div>
                
                <div style="position: relative; z-index: 2; text-align: center; width: 100%;">
                    <div style="position: relative; width: clamp(120px, 40vw, 200px); height: clamp(120px, 40vw, 200px); margin: 0 auto 15px; border-radius: 50%; overflow: hidden; border: 4px solid white; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); animation: avatarPulse 2.5s ease-in-out infinite; aspect-ratio: 1;">
                        <img src="src/frontend/dist/images/Paulmichael.png" alt="Paul Michael" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                        <div id="voiceIndicator" style="position: absolute; width: 100%; height: 100%; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: white; background: rgba(0, 0, 0, 0.4); opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 10;"></div>
                        <div style="position: absolute; bottom: 8px; right: 8px; width: 18px; height: 18px; background: #10b981; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 15px rgba(16, 185, 129, 0.6); animation: statusPulse 2s ease-in-out infinite; z-index: 10;"></div>
                    </div>

                    <div style="color: white; z-index: 2;">
                        <div style="font-size: clamp(18px, 4vw, 28px); font-weight: 700; margin-bottom: 6px; letter-spacing: -0.5px; line-height: 1.2;">Ambassador Paul</div>
                        <div style="font-size: clamp(12px, 2.5vw, 14px); color: rgba(255, 255, 255, 0.9); font-weight: 500; margin-bottom: 8px;">AI Learning Expert</div>
                        <div style="font-size: clamp(11px, 2vw, 13px); color: rgba(255, 255, 255, 0.85); display: flex; align-items: center; gap: 6px; justify-content: center; flex-wrap: wrap;">
                            <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: blink 1.5s ease-in-out infinite;"></span>
                            <span id="avatarStatus">Online & Ready</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Panel -->
            <div class="chat-panel-surface" style="display: flex; flex-direction: column; background: #f8fafc; padding: 0; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 18px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.25); gap: 12px; flex-wrap: wrap; min-height: 50px;">
                    <div style="font-size: clamp(14px, 3vw, 18px); font-weight: 700; letter-spacing: -0.3px; flex-shrink: 0;">Live Chat</div>
                    <div style="display: flex; gap: 6px; align-items: center;">
                        <button id="sizeSmallBtn" style="background: rgba(255, 255, 255, 0.25); border: 1px solid rgba(255, 255, 255, 0.4); color: white; font-size: 11px; cursor: pointer; padding: 5px 8px; border-radius: 6px; transition: all 0.3s; font-weight: 600; flex-shrink: 0;" title="Small Size">S</button>
                        <button id="sizeMediumBtn" style="background: rgba(255, 255, 255, 0.25); border: 1px solid rgba(255, 255, 255, 0.4); color: white; font-size: 11px; cursor: pointer; padding: 5px 8px; border-radius: 6px; transition: all 0.3s; font-weight: 600; flex-shrink: 0;" title="Medium Size">M</button>
                        <button id="sizeLargeBtn" style="background: rgba(255, 255, 255, 0.35); border: 2px solid rgba(255, 255, 255, 0.8); color: white; font-size: 11px; cursor: pointer; padding: 5px 8px; border-radius: 6px; transition: all 0.3s; font-weight: 600; flex-shrink: 0;" title="Large Size">L</button>
                        <button id="chatThemeBtn" style="background: rgba(255, 255, 255, 0.15); border: none; color: white; font-size: 18px; cursor: pointer; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; flex-shrink: 0;" title="Toggle theme">üåô</button>
                        <button id="chatMinBtn" style="background: rgba(255, 255, 255, 0.15); border: none; color: white; font-size: 18px; cursor: pointer; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; flex-shrink: 0;" title="Minimize">‚Äî</button>
                        <button id="chatCloseBtn" style="background: rgba(255, 255, 255, 0.15); border: none; color: white; font-size: 20px; cursor: pointer; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; flex-shrink: 0;">‚úï</button>
                    </div>
                </div>

                <div id="chatMessages" class="chat-messages-surface" style="flex: 1; overflow-y: auto; padding: 18px; display: flex; flex-direction: column; gap: 12px; background: white; scroll-behavior: smooth; min-height: 0;">
                    <div style="text-align: center; color: #999; padding: 16px; font-size: 12px; line-height: 1.5;">
                        üëã Welcome! I'm Ambassador Paul, your AI expert. Ask me anything about Athena Chatbot AI, courses, or learning. Voice enabled! üé§
                    </div>
                </div>

                <div class="chat-toolbar" id="quickChips">
                    <button class="chat-chip" data-prompt="What is LMS?">What is LMS?</button>
                    <button class="chat-chip" data-prompt="How do I access my courses?">Access Courses</button>
                    <button class="chat-chip" data-prompt="How do I cancel my subscription?">Cancel Subscription</button>
                    <button class="chat-chip" data-prompt="Help me with budgeting">Budget Help</button>
                </div>

                <div class="chat-input-surface" style="padding: 14px 16px; border-top: 1px solid #e5e7eb; background: white; display: flex; gap: 8px; align-items: flex-end; flex-shrink: 0;">
                    <div class="chat-input-wrap" style="flex: 1; display: flex; align-items: center; gap: 8px; background: #f8fafc; border: 2px solid #e5e7eb; border-radius: 20px; padding: 10px 16px; transition: all 0.3s; min-width: 0;">
                        <input id="chatInput" class="chat-input" type="text" placeholder="Type or speak..." style="flex: 1; border: none; outline: none; font-size: 14px; line-height: 1.35; background: transparent; color: #111827; min-width: 0;" autocomplete="off">
                    </div>
                    <button id="chatSendBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25); flex-shrink: 0;">üì§</button>
                    <button id="chatMicBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25); flex-shrink: 0;">üéôÔ∏è</button>
                    <button id="chatS2sBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: rgba(59, 130, 246, 0.12); color: #1e3a8a; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; border: 1px solid rgba(59, 130, 246, 0.25); flex-shrink: 0;" title="Speech-to-Speech: OFF (click to turn on)">üó£Ô∏è</button>
                    <button id="chatTtsBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: rgba(102, 126, 234, 0.12); color: #4c1d95; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; border: 1px solid rgba(102, 126, 234, 0.25); flex-shrink: 0;" title="Toggle voice output">üîä</button>
                    <button id="chatAccurateBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: rgba(16, 185, 129, 0.12); color: #065f46; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; border: 1px solid rgba(16, 185, 129, 0.25); flex-shrink: 0;" title="Accurate mode: ON (uses more context)">üéØ</button>
                    <button id="chatFastBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: rgba(239, 68, 68, 0.12); color: #7f1d1d; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; border: 1px solid rgba(239, 68, 68, 0.25); flex-shrink: 0;" title="Fast Mode: OFF (ultra-low latency)">üöÄ</button>
                    <button id="chatRealtimeBtn" style="width: 40px; height: 40px; border: none; border-radius: 50%; background: rgba(59, 130, 246, 0.12); color: #1e3a8a; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 17px; transition: all 0.25s; border: 1px solid rgba(59, 130, 246, 0.25); flex-shrink: 0;" title="Real-time Mode: OFF (zero latency)">‚ö°</button>
                </div>
            </div>
        </div>
        <div class="chatbot-resize-handle"></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>Products</h4>
                <a href="#">AI Avatars</a>
                <a href="#">Creative Reality Studio</a>
                <a href="#">API for Developers</a>
                <a href="#">Mobile App</a>
            </div>

            <div class="footer-section">
                <h4>Solutions</h4>
                <a href="#">Marketing Suite</a>
                <a href="#">Sales Solutions</a>
                <a href="#">Learning & Development</a>
                <a href="#">Customer Experience</a>
            </div>

            <div class="footer-section">
                <h4>Company</h4>
                <a href="#">About</a>
                <a href="#">Careers</a>
                <a href="#">Blog</a>
                <a href="#">Contact Sales</a>
            </div>

            <div class="footer-section">
                <h4>Resources</h4>
                <a href="#">Documentation</a>
                <a href="#">Help Center</a>
                <a href="#">Trust Center</a>
                <a href="#">Privacy Policy</a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2026 Athena Chatbot AI - Enterprise AI Avatar Platform. All rights reserved.</p>
        </div>
    </footer>



    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes avatarPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            }
        }

        @keyframes statusPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.6); }
            50% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.8); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes recordPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0.2); }
        }
    </style>

    <script>
        const chatbotBtn = document.getElementById('chatbotBtn');
        const chatbotModal = document.getElementById('chatbotContainer');
        const chatCloseBtn = document.getElementById('chatCloseBtn');
        const chatThemeBtn = document.getElementById('chatThemeBtn');
        const chatMinBtn = document.getElementById('chatMinBtn');
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatMicBtn = document.getElementById('chatMicBtn');
        const chatS2sBtn = document.getElementById('chatS2sBtn');
        const chatTtsBtn = document.getElementById('chatTtsBtn');
        const chatAccurateBtn = document.getElementById('chatAccurateBtn');
        const chatFastBtn = document.getElementById('chatFastBtn');
        const chatRealtimeBtn = document.getElementById('chatRealtimeBtn');
        const quickChips = document.getElementById('quickChips');
        const chatMessages = document.getElementById('chatMessages');
        const voiceIndicator = document.getElementById('voiceIndicator');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        const synth = window.speechSynthesis;

        let isListening = false;

        // Whisper STT (backend) via WAV recording
        const STT_ENDPOINTS = [
            'http://localhost:8000/api/stt/transcribe',
            'http://localhost:8001/api/stt/transcribe',
            'http://localhost:8002/api/stt/transcribe',
            'http://localhost:5000/api/stt/transcribe'
        ];

        const TTS_AUDIO_ENDPOINTS = [
            'http://localhost:8000/api/tts/synthesize-audio',
            'http://localhost:8001/api/tts/synthesize-audio',
            'http://localhost:8002/api/tts/synthesize-audio',
            'http://localhost:5000/api/tts/synthesize-audio'
        ];

        const S2S_METADATA_ENDPOINTS = [
            'http://localhost:8000/api/speech-to-speech/metadata',
            'http://localhost:8001/api/speech-to-speech/metadata',
            'http://localhost:8002/api/speech-to-speech/metadata',
            'http://localhost:5000/api/speech-to-speech/metadata'
        ];

        const S2S_STREAM_ENDPOINTS = {
            start: 'http://localhost:8000/api/speech-to-speech/stream-start',
            chunk: 'http://localhost:8000/api/speech-to-speech/stream-chunk',
            end: 'http://localhost:8000/api/speech-to-speech/stream-end'
        };

        let whisperRecording = null;
        let whisperPcmChunks = [];
        let whisperStreamInterval = null;
        let isStreaming = false;

        let speechToSpeechMode = false;
        let fastMode = false;
        let realtimeMode = false;
        let activeAudioEl = null;
        let isVoiceProcessing = false;
        let realtimeWs = null;

        let ttsEnabled = true;
        let activeUtterance = null;

        let accurateMode = true;
        const chatHistory = [];
        const MAX_HISTORY = 12;

        let theme = localStorage.getItem('athena_chat_theme') || 'light';

        function applyTheme() {
            if (theme === 'dark') {
                chatbotModal.classList.add('chat-dark');
                if (chatThemeBtn) chatThemeBtn.textContent = '‚òÄÔ∏è';
            } else {
                chatbotModal.classList.remove('chat-dark');
                if (chatThemeBtn) chatThemeBtn.textContent = 'üåô';
            }
        }

        const CHAT_ENDPOINTS = [
            'http://localhost:8000/api/chat',
            'http://localhost:8001/api/chat',
            'http://localhost:8002/api/chat',
            'http://localhost:5000/api/chat'
        ];

        function formatTime(d = new Date()) {
            const hh = String(d.getHours()).padStart(2, '0');
            const mm = String(d.getMinutes()).padStart(2, '0');
            return `${hh}:${mm}`;
        }

        const hasWhisperBrowserSupport = !!(navigator.mediaDevices && (window.AudioContext || window.webkitAudioContext));

        if (recognition) {
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
        }

        if (!recognition && !hasWhisperBrowserSupport) {
            chatMicBtn.style.opacity = '0.6';
            chatMicBtn.style.cursor = 'not-allowed';
            chatMicBtn.title = 'Speech-to-Text not supported in this browser. Use Chrome/Edge.';
        }

        // ===== DRAGGING FUNCTIONALITY =====
        let isDragging = false;
        let startX, startY, startLeft, startTop;

        const chatbotHeader = document.querySelector('#chatbotContainer > div > div:first-child > div:first-child');
        
        if (chatbotHeader) {
            chatbotHeader.parentElement.addEventListener('mousedown', (e) => {
                if (e.target.closest('button') || e.target.closest('input')) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startLeft = chatbotModal.offsetLeft;
                startTop = chatbotModal.offsetTop;
                chatbotModal.style.cursor = 'grabbing';
            });
        }

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            chatbotModal.style.left = (startLeft + deltaX) + 'px';
            chatbotModal.style.top = (startTop + deltaY) + 'px';
            chatbotModal.style.right = 'auto';
            chatbotModal.style.bottom = 'auto';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            chatbotModal.style.cursor = 'grab';
        });

        // ===== RESIZING FUNCTIONALITY =====
        let isResizing = false;
        let didResize = false;
        let startWidth, startHeight;
        const resizeHandle = document.querySelector('.chatbot-resize-handle');

        if (resizeHandle) {
            resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                didResize = true;
                startWidth = chatbotModal.offsetWidth;
                startHeight = chatbotModal.offsetHeight;
                startX = e.clientX;
                startY = e.clientY;
                e.preventDefault();
            });
        }

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            const newWidth = startWidth + (e.clientX - startX);
            const newHeight = startHeight + (e.clientY - startY);
            
            if (newWidth > 300) chatbotModal.style.width = newWidth + 'px';
            if (newHeight > 150) chatbotModal.style.height = newHeight + 'px';
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            if (didResize) {
                didResize = false;
                saveChatSize();
            }
        });

        // ===== SIZE CUSTOMIZATION =====
        const sizeSmallBtn = document.getElementById('sizeSmallBtn');
        const sizeMediumBtn = document.getElementById('sizeMediumBtn');
        const sizeLargeBtn = document.getElementById('sizeLargeBtn');

        function setSize(width, height, button) {
            chatbotModal.style.width = width + 'px';
            chatbotModal.style.height = height + 'px';

            saveChatSize();
            
            // Update button styles
            [sizeSmallBtn, sizeMediumBtn, sizeLargeBtn].forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.25)';
                btn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
            });
            
            button.style.background = 'rgba(255, 255, 255, 0.35)';
            button.style.border = '2px solid rgba(255, 255, 255, 0.8)';
        }

        sizeSmallBtn.addEventListener('click', () => {
            setSize(360, 480, sizeSmallBtn);
        });

        sizeMediumBtn.addEventListener('click', () => {
            setSize(440, 540, sizeMediumBtn);
        });

        sizeLargeBtn.addEventListener('click', () => {
            setSize(520, 600, sizeLargeBtn);
        });

        function clampChatSize(w, h) {
            const maxW = Math.max(350, window.innerWidth - 40);
            const maxH = Math.max(520, window.innerHeight - 140);
            return {
                w: Math.min(Math.max(350, w), maxW),
                h: Math.min(Math.max(520, h), maxH)
            };
        }

        function saveChatSize() {
            const w = parseInt(chatbotModal.style.width || chatbotModal.offsetWidth, 10);
            const h = parseInt(chatbotModal.style.height || chatbotModal.offsetHeight, 10);
            if (!Number.isFinite(w) || !Number.isFinite(h)) return;
            const clamped = clampChatSize(w, h);
            localStorage.setItem('athena_chat_w', String(clamped.w));
            localStorage.setItem('athena_chat_h', String(clamped.h));
        }

        function applySavedChatSize() {
            const w = parseInt(localStorage.getItem('athena_chat_w') || '', 10);
            const h = parseInt(localStorage.getItem('athena_chat_h') || '', 10);
            if (!Number.isFinite(w) || !Number.isFinite(h)) return;
            const clamped = clampChatSize(w, h);
            chatbotModal.style.width = clamped.w + 'px';
            chatbotModal.style.height = clamped.h + 'px';
        }

        function scrollToChat() {
            chatbotModal.style.display = 'block';
            chatbotModal.style.width = '520px';
            chatbotModal.style.height = '600px';
            applySavedChatSize();
            applyTheme();
            chatbotModal.style.opacity = '1';
            chatbotModal.style.pointerEvents = 'all';
            chatbotBtn.style.background = 'linear-gradient(135deg, #764ba2, #667eea)';
            
            // Highlight Large button as default
            sizeLargeBtn.style.background = 'rgba(255, 255, 255, 0.35)';
            sizeLargeBtn.style.border = '2px solid rgba(255, 255, 255, 0.8)';
            sizeSmallBtn.style.background = 'rgba(255, 255, 255, 0.25)';
            sizeSmallBtn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
            sizeMediumBtn.style.background = 'rgba(255, 255, 255, 0.25)';
            sizeMediumBtn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
            
            chatInput.focus();
        }

        chatbotBtn.addEventListener('click', () => {
            const isActive = chatbotModal.style.display === 'block';
            if (isActive) {
                chatbotModal.style.display = 'none';
                chatbotModal.style.width = '0';
                chatbotModal.style.height = '0';
                chatbotModal.style.opacity = '0';
                chatbotModal.style.pointerEvents = 'none';
                chatbotBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            } else {
                scrollToChat();
            }
        });

        chatCloseBtn.addEventListener('click', () => {
            chatbotModal.style.display = 'none';
            chatbotModal.style.width = '0';
            chatbotModal.style.height = '0';
            chatbotModal.style.opacity = '0';
            chatbotModal.style.pointerEvents = 'none';
            chatbotBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        });

        if (chatThemeBtn) {
            chatThemeBtn.addEventListener('click', () => {
                theme = (theme === 'dark') ? 'light' : 'dark';
                localStorage.setItem('athena_chat_theme', theme);
                applyTheme();
            });
        }

        chatMinBtn.addEventListener('click', () => {
            chatbotModal.style.display = 'none';
            chatbotModal.style.opacity = '0';
            chatbotModal.style.pointerEvents = 'none';
            chatbotBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        });

        if (quickChips) {
            quickChips.addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-prompt]');
                if (!btn) return;
                chatInput.value = btn.getAttribute('data-prompt') || '';
                sendMessage();
            });
        }

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            chatInput.value = '';

            chatHistory.push({ role: 'user', content: text });
            while (chatHistory.length > MAX_HISTORY) chatHistory.shift();

            const timeStr = formatTime();

            const userMsg = document.createElement('div');
            userMsg.style.cssText = 'display: flex; justify-content: flex-end; animation: slideIn 0.4s ease;';
            userMsg.innerHTML = `<div class="chat-bubble-user" style="max-width: 78%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.45; background: linear-gradient(135deg, #667eea, #764ba2); color: white; box-shadow: 0 10px 20px rgba(102, 126, 234, 0.22);">${escapeHtml(text)}<div class="bubble-time" style="color: rgba(255, 255, 255, 0.85);">${timeStr}</div></div>`;
            chatMessages.appendChild(userMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            showTyping();

            try {
                const { data, usedUrl } = await postToFirstWorkingEndpoint({
                    message: text,
                    accurate: accurateMode,
                    history: chatHistory
                });
                const botResponse = (data && data.response) ? data.response : 'Sorry, I could not process your request.';

                removeTyping();

                const botTimeStr = formatTime();

                const botMsg = document.createElement('div');
                botMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
                botMsg.innerHTML = `<div id="lastBotBubble" class="chat-bubble-bot" style="max-width: 78%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.6; background: linear-gradient(135deg, #f0f4ff, #f7ebff); color: #312e81; border: 1px solid rgba(102, 126, 234, 0.18); box-shadow: 0 10px 20px rgba(17, 24, 39, 0.06);"></div>`;
                chatMessages.appendChild(botMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                const bubbleEl = botMsg.querySelector('#lastBotBubble');
                if (bubbleEl) {
                    await typewriterText(bubbleEl, botResponse, 10);
                    const timeEl = document.createElement('div');
                    timeEl.className = 'bubble-time';
                    timeEl.style.color = 'rgba(49, 46, 129, 0.75)';
                    timeEl.textContent = botTimeStr;
                    bubbleEl.appendChild(timeEl);

                    const copyRow = document.createElement('div');
                    copyRow.style.cssText = 'display: flex; justify-content: flex-end; margin-top: 10px;';
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'chat-copy-btn';
                    copyBtn.type = 'button';
                    copyBtn.textContent = 'Copy';
                    copyBtn.addEventListener('click', async () => {
                        try {
                            await navigator.clipboard.writeText(botResponse);
                            copyBtn.textContent = 'Copied';
                            window.setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
                        } catch (_) {
                            copyBtn.textContent = 'Failed';
                            window.setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
                        }
                    });
                    copyRow.appendChild(copyBtn);
                    bubbleEl.appendChild(copyRow);
                }

                chatHistory.push({ role: 'assistant', content: botResponse });
                while (chatHistory.length > MAX_HISTORY) chatHistory.shift();

                if (ttsEnabled) {
                    speak(botResponse);
                }
            } catch (error) {
                removeTyping();
                console.error('Error:', error);
                
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
                errorMsg.innerHTML = `<div style="max-width: 75%; padding: 14px 18px; border-radius: 18px; font-size: 14px; background: linear-gradient(135deg, #fee2e2, #fecaca); color: #7f1d1d; border: 1px solid rgba(239, 68, 68, 0.15); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">Sorry, I couldn't connect to the backend. Start your backend on 8001/8002 (FastAPI) or 5000 (Flask).</div>`;
                chatMessages.appendChild(errorMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function appendUserBubble(text) {
            const timeStr = formatTime();

            const userMsg = document.createElement('div');
            userMsg.style.cssText = 'display: flex; justify-content: flex-end; animation: slideIn 0.4s ease;';
            userMsg.innerHTML = `<div class="chat-bubble-user" style="max-width: 78%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.45; background: linear-gradient(135deg, #667eea, #764ba2); color: white; box-shadow: 0 10px 20px rgba(102, 126, 234, 0.22);">${escapeHtml(text)}<div class="bubble-time" style="color: rgba(255, 255, 255, 0.85);">${timeStr}</div></div>`;
            chatMessages.appendChild(userMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function appendBotBubble(botResponse) {
            const botTimeStr = formatTime();

            const botMsg = document.createElement('div');
            botMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
            botMsg.innerHTML = `<div id="lastBotBubble" class="chat-bubble-bot" style="max-width: 78%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.6; background: linear-gradient(135deg, #f0f4ff, #f7ebff); color: #312e81; border: 1px solid rgba(102, 126, 234, 0.18); box-shadow: 0 10px 20px rgba(17, 24, 39, 0.06);"></div>`;
            chatMessages.appendChild(botMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const bubbleEl = botMsg.querySelector('#lastBotBubble');
            if (bubbleEl) {
                await typewriterText(bubbleEl, botResponse, 10);
                const timeEl = document.createElement('div');
                timeEl.className = 'bubble-time';
                timeEl.style.color = 'rgba(49, 46, 129, 0.75)';
                timeEl.textContent = botTimeStr;
                bubbleEl.appendChild(timeEl);

                const copyRow = document.createElement('div');
                copyRow.style.cssText = 'display: flex; justify-content: flex-end; margin-top: 10px;';
                const copyBtn = document.createElement('button');
                copyBtn.className = 'chat-copy-btn';
                copyBtn.type = 'button';
                copyBtn.textContent = 'Copy';
                copyBtn.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(botResponse);
                        copyBtn.textContent = 'Copied';
                        window.setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
                    } catch (_) {
                        copyBtn.textContent = 'Failed';
                        window.setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
                    }
                });
                copyRow.appendChild(copyBtn);
                bubbleEl.appendChild(copyRow);
            }
        }

        function typewriterText(el, text, delayMs) {
            return new Promise((resolve) => {
                const safe = (text || '').toString();
                let i = 0;
                const tick = () => {
                    i += 2;
                    el.textContent = safe.slice(0, i);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    if (i >= safe.length) {
                        resolve();
                        return;
                    }
                    window.setTimeout(tick, delayMs);
                };
                tick();
            });
        }

        async function postToFirstWorkingEndpoint(payload) {
            let lastError = null;
            for (const url of CHAT_ENDPOINTS) {
                try {
                    const response = await fetchWithTimeout(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json().catch(() => ({}));
                    if (response.ok) {
                        return { data, usedUrl: url };
                    }
                    lastError = new Error((data && data.detail) ? data.detail : `HTTP ${response.status}`);
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError || new Error('No backend endpoints available');
        }

        async function fetchWithTimeout(url, options = {}, timeoutMs = 45000) {
            const controller = new AbortController();
            const id = window.setTimeout(() => controller.abort(), timeoutMs);
            try {
                const merged = { ...options, signal: controller.signal };
                return await fetch(url, merged);
            } finally {
                window.clearTimeout(id);
            }
        }

        async function postToFirstWorkingSttEndpoint(audioBlob, language = 'en') {
            let lastError = null;
            for (const url of STT_ENDPOINTS) {
                try {
                    const form = new FormData();
                    form.append('audio_file', audioBlob, 'speech.wav');
                    if (language) form.append('language', language);

                    const response = await fetchWithTimeout(url, {
                        method: 'POST',
                        body: form
                    });

                    const data = await response.json().catch(() => ({}));
                    if (response.ok) return { data, usedUrl: url };
                    lastError = new Error((data && data.detail) ? data.detail : `HTTP ${response.status}`);
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError || new Error('No STT endpoints available');
        }

        async function postToFirstWorkingS2sMetadataEndpoint(audioBlob, language = 'en') {
            let lastError = null;
            for (const url of S2S_METADATA_ENDPOINTS) {
                try {
                    const form = new FormData();
                    form.append('audio_file', audioBlob, 'speech.wav');
                    if (language) form.append('language', language);

                    const response = await fetchWithTimeout(url, {
                        method: 'POST',
                        body: form
                    });

                    const data = await response.json().catch(() => ({}));
                    if (response.ok) return { data, usedUrl: url };
                    lastError = new Error((data && data.detail) ? data.detail : `HTTP ${response.status}`);
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError || new Error('No Speech-to-Speech metadata endpoints available');
        }

        async function postToFirstWorkingTtsAudioEndpoint(payload) {
            let lastError = null;
            for (const url of TTS_AUDIO_ENDPOINTS) {
                try {
                    const response = await fetchWithTimeout(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        return { blob, usedUrl: url };
                    }

                    const data = await response.json().catch(() => ({}));
                    lastError = new Error((data && data.detail) ? data.detail : `HTTP ${response.status}`);
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError || new Error('No TTS endpoints available');
        }

        function stopBackendAudio() {
            if (!activeAudioEl) return;
            try {
                activeAudioEl.pause();
            } catch (_) {}
            try {
                if (activeAudioEl.src) URL.revokeObjectURL(activeAudioEl.src);
            } catch (_) {}
            activeAudioEl = null;
        }

        async function playBackendTts(text) {
            stopBackendAudio();
            if (!text) return;
            const { blob } = await postToFirstWorkingTtsAudioEndpoint({ text, language: 'en', voice: 'en-US-GuyNeural' });
            const audioUrl = URL.createObjectURL(blob);
            const audio = new Audio(audioUrl);
            try {
                audio.preload = 'auto';
                audio.volume = 1;
                audio.muted = false;
                audio.playsInline = true;
            } catch (_) {}
            audio.onended = () => {
                try { URL.revokeObjectURL(audioUrl); } catch (_) {}
                activeAudioEl = null;
                if (!isListening) voiceIndicator.style.opacity = '0';
            };
            audio.onerror = () => {
                try { URL.revokeObjectURL(audioUrl); } catch (_) {}
                activeAudioEl = null;
                if (!isListening) voiceIndicator.style.opacity = '0';
            };

            activeAudioEl = audio;
            voiceIndicator.style.opacity = '1';
            voiceIndicator.textContent = 'üîä Speaking...';
            try {
                await audio.play();
            } catch (e) {
                console.error('Audio playback blocked/failed:', e);
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
                errorMsg.innerHTML = `<div style="max-width: 75%; padding: 14px 18px; border-radius: 18px; font-size: 14px; background: linear-gradient(135deg, #fee2e2, #fecaca); color: #7f1d1d; border: 1px solid rgba(239, 68, 68, 0.15); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">Audio playback was blocked by the browser. Click anywhere in the page and try again.</div>`;
                chatMessages.appendChild(errorMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                try {
                    stopBackendAudio();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1;
                    utterance.pitch = 1.05;
                    utterance.volume = 1;
                    utterance.onend = () => {
                        if (!isListening) voiceIndicator.style.opacity = '0';
                    };
                    synth.speak(utterance);
                } catch (_) {
                    if (!isListening) voiceIndicator.style.opacity = '0';
                }
            }
        }

        function downsampleBuffer(buffer, inputSampleRate, outputSampleRate) {
            if (outputSampleRate === inputSampleRate) return buffer;
            if (outputSampleRate > inputSampleRate) return buffer;

            const sampleRateRatio = inputSampleRate / outputSampleRate;
            const newLength = Math.round(buffer.length / sampleRateRatio);
            const result = new Float32Array(newLength);

            let offsetResult = 0;
            let offsetBuffer = 0;
            while (offsetResult < result.length) {
                const nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);
                let accum = 0;
                let count = 0;
                for (let i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {
                    accum += buffer[i];
                    count++;
                }
                result[offsetResult] = count > 0 ? (accum / count) : 0;
                offsetResult++;
                offsetBuffer = nextOffsetBuffer;
            }
            return result;
        }

        function encodeWav16kMono(float32Samples, inputSampleRate) {
            const targetRate = 16000;
            const samples = downsampleBuffer(float32Samples, inputSampleRate, targetRate);

            const buffer = new ArrayBuffer(44 + samples.length * 2);
            const view = new DataView(buffer);

            const writeString = (offset, str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset + i, str.charCodeAt(i));
                }
            };

            writeString(0, 'RIFF');
            view.setUint32(4, 36 + samples.length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true); // PCM
            view.setUint16(20, 1, true); // Linear PCM
            view.setUint16(22, 1, true); // Mono
            view.setUint32(24, targetRate, true);
            view.setUint32(28, targetRate * 2, true); // Byte rate
            view.setUint16(32, 2, true); // Block align
            view.setUint16(34, 16, true); // Bits per sample
            writeString(36, 'data');
            view.setUint32(40, samples.length * 2, true);

            let offset = 44;
            for (let i = 0; i < samples.length; i++) {
                let s = Math.max(-1, Math.min(1, samples[i]));
                view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
                offset += 2;
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        async function startWhisperRecording() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const AudioContextCtor = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContextCtor();
            const source = audioContext.createMediaStreamSource(stream);

            const processor = audioContext.createScriptProcessor(4096, 1, 1);
            whisperPcmChunks = [];
            processor.onaudioprocess = (e) => {
                const input = e.inputBuffer.getChannelData(0);
                whisperPcmChunks.push(new Float32Array(input));
            };

            source.connect(processor);
            processor.connect(audioContext.destination);

            whisperRecording = {
                stream,
                audioContext,
                source,
                processor,
                sampleRate: audioContext.sampleRate
            };
        }

        async function stopWhisperRecordingAndTranscribe() {
            if (!whisperRecording) return '';

            const { stream, audioContext, source, processor, sampleRate } = whisperRecording;
            try {
                processor.disconnect();
            } catch (_) {}
            try {
                source.disconnect();
            } catch (_) {}
            try {
                stream.getTracks().forEach(t => t.stop());
            } catch (_) {}
            try {
                await audioContext.close();
            } catch (_) {}

            const totalLength = whisperPcmChunks.reduce((acc, a) => acc + a.length, 0);
            const merged = new Float32Array(totalLength);
            let offset = 0;
            for (const chunk of whisperPcmChunks) {
                merged.set(chunk, offset);
                offset += chunk.length;
            }

            whisperRecording = null;
            whisperPcmChunks = [];

            const wavBlob = encodeWav16kMono(merged, sampleRate);
            const { data } = await postToFirstWorkingSttEndpoint(wavBlob, 'en');
            const text = (data && data.text) ? String(data.text).trim() : '';
            return text;
        }

        function setMicUiListening(on) {
            if (on) {
                try {
                    chatMicBtn.disabled = false;
                    if (chatS2sBtn) chatS2sBtn.disabled = false;
                    chatMicBtn.style.opacity = '1';
                    if (chatS2sBtn) chatS2sBtn.style.opacity = '1';
                } catch (_) {}
                chatMicBtn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                chatMicBtn.style.animation = 'recordPulse 1.2s ease-in-out infinite';
                voiceIndicator.style.opacity = '1';
                voiceIndicator.textContent = 'üé§ Listening...';
            } else {
                try {
                    chatMicBtn.disabled = false;
                    if (chatS2sBtn) chatS2sBtn.disabled = false;
                    chatMicBtn.style.opacity = '1';
                    if (chatS2sBtn) chatS2sBtn.style.opacity = '1';
                } catch (_) {}
                chatMicBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                chatMicBtn.style.animation = 'none';
                voiceIndicator.style.opacity = '0';
            }
        }

        function setMicUiProcessing() {
            try {
                chatMicBtn.disabled = true;
                if (chatS2sBtn) chatS2sBtn.disabled = true;
                chatMicBtn.style.opacity = '0.7';
                if (chatS2sBtn) chatS2sBtn.style.opacity = '0.7';
            } catch (_) {}
            chatMicBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            chatMicBtn.style.animation = 'none';
            voiceIndicator.style.opacity = '1';
            voiceIndicator.textContent = 'üß† Processing...';
        }

        function setMicUiStreaming(on) {
            if (on) {
                voiceIndicator.style.opacity = '1';
                voiceIndicator.textContent = 'üì° Streaming...';
            } else {
                voiceIndicator.style.opacity = '0';
            }
        }

        function startWhisperStreaming() {
            if (isStreaming) return;
            isStreaming = true;
            setMicUiStreaming(true);
            
            // Use WebSocket if real-time mode is enabled
            if (realtimeMode && realtimeWs && realtimeWs.readyState === WebSocket.OPEN) {
                // Real-time WebSocket streaming
                whisperStreamInterval = setInterval(async () => {
                    if (!whisperRecording || !isStreaming) return;
                    const { sampleRate } = whisperRecording;
                    const merged = mergeFloat32Arrays(whisperPcmChunks);
                    whisperPcmChunks = [];
                    if (merged.length === 0) return;
                    const wavBlob = encodeWav16kMono(merged, sampleRate);
                    
                    // Convert to base64 and send via WebSocket
                    const reader = new FileReader();
                    reader.onload = () => {
                        const base64 = reader.result.split(',')[1];
                        realtimeWs.send(JSON.stringify({
                            type: 'audio_chunk',
                            audio: base64
                        }));
                    };
                    reader.readAsDataURL(wavBlob);
                }, 80);
                return;
            }
            
            // Regular HTTP streaming
            (async () => {
                try {
                    await fetchWithTimeout(S2S_STREAM_ENDPOINTS.start, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ language: 'en', voice: 'en-US-GuyNeural', fast_mode: fastMode })
                    });
                } catch (_) {}
            })();
            const interval = fastMode ? 80 : 150;
            whisperStreamInterval = setInterval(async () => {
                if (!whisperRecording || !isStreaming) return;
                const { sampleRate } = whisperRecording;
                const merged = mergeFloat32Arrays(whisperPcmChunks);
                whisperPcmChunks = [];
                if (merged.length === 0) return;
                const wavBlob = encodeWav16kMono(merged, sampleRate);
                try {
                    const form = new FormData();
                    form.append('audio_file', wavBlob, 'chunk.wav');
                    form.append('language', 'en');
                    form.append('fast_mode', fastMode.toString());
                    const resp = await fetchWithTimeout(S2S_STREAM_ENDPOINTS.chunk, {
                        method: 'POST',
                        body: form
                    });
                    const data = await resp.json().catch(() => ({}));
                    if (data && data.partial_text) {
                        // Show partial transcript in real-time
                        voiceIndicator.style.opacity = '1';
                        voiceIndicator.textContent = `üé§ ${data.partial_text}`;
                    }
                } catch (_) {
                    // Ignore streaming errors; final processing will handle fallback
                }
            }, interval);
        }

        function stopWhisperStreaming() {
            isStreaming = false;
            setMicUiStreaming(false);
            if (whisperStreamInterval) {
                clearInterval(whisperStreamInterval);
                whisperStreamInterval = null;
            }
        }

        async function finalizeStreamingResponse() {
            if (!speechToSpeechMode) return;
            
            // Use WebSocket if real-time mode is enabled
            if (realtimeMode && realtimeWs && realtimeWs.readyState === WebSocket.OPEN) {
                realtimeWs.send(JSON.stringify({ type: 'end_speech' }));
                setMicUiProcessing();
                // WebSocket will handle the rest via onmessage events
                return;
            }
            
            // Regular HTTP streaming
            setMicUiProcessing();
            try {
                const resp = await fetchWithTimeout(S2S_STREAM_ENDPOINTS.end, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ language: 'en', voice: 'en-US-GuyNeural', fast_mode: fastMode })
                });
                if (resp.ok) {
                    const transcript = resp.headers.get('X-Transcript') || '';
                    const response = resp.headers.get('X-Response') || '';
                    if (transcript) {
                        appendUserBubble(transcript);
                        chatHistory.push({ role: 'user', content: transcript });
                        while (chatHistory.length > MAX_HISTORY) chatHistory.shift();
                    }
                    if (response) {
                        await appendBotBubble(response);
                        chatHistory.push({ role: 'assistant', content: response });
                        while (chatHistory.length > MAX_HISTORY) chatHistory.shift();
                        if (ttsEnabled) {
                            try {
                                voiceIndicator.style.opacity = '1';
                                voiceIndicator.textContent = 'üîä Speaking...';
                                const blob = await resp.blob();
                                const audioUrl = URL.createObjectURL(blob);
                                const audio = new Audio(audioUrl);
                                try {
                                    audio.preload = 'auto';
                                    audio.volume = 1;
                                    audio.muted = false;
                                    audio.playsInline = true;
                                } catch (_) {}
                                audio.onended = () => {
                                    try { URL.revokeObjectURL(audioUrl); } catch (_) {}
                                    activeAudioEl = null;
                                    if (!isListening) voiceIndicator.style.opacity = '0';
                                };
                                audio.onerror = () => {
                                    try { URL.revokeObjectURL(audioUrl); } catch (_) {}
                                    activeAudioEl = null;
                                    if (!isListening) voiceIndicator.style.opacity = '0';
                                };
                                activeAudioEl = audio;
                                await audio.play();
                            } catch (e) {
                                console.error('Streaming audio playback failed:', e);
                                voiceIndicator.style.opacity = '1';
                                voiceIndicator.innerHTML = '<div style="display: flex; gap: 3px;"><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.1s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.2s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.3s;"></div></div>';
                                speak(response);
                            }
                        }
                    }
                } else {
                    throw new Error('Stream end failed');
                }
            } catch (e) {
                console.error('Streaming finalization error:', e);
                // Fallback to normal metadata endpoint
                await handleWhisperStopAndProcess();
            }
        }

        function stopSpeaking() {
            stopBackendAudio();
            try {
                synth.cancel();
            } catch (_) {}
            activeUtterance = null;
            if (!isListening) {
                voiceIndicator.style.opacity = '0';
            }
        }

        function speak(text) {
            stopSpeaking();
            if (!text || !synth) return;

            voiceIndicator.style.opacity = '1';
            voiceIndicator.innerHTML = '<div style="display: flex; gap: 3px;"><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.1s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.2s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.3s;"></div></div>';

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1;
            utterance.pitch = 1.05;
            utterance.volume = 1;
            utterance.onend = () => {
                activeUtterance = null;
                if (!isListening) {
                    voiceIndicator.style.opacity = '0';
                }
            };
            utterance.onerror = () => {
                activeUtterance = null;
                if (!isListening) {
                    voiceIndicator.style.opacity = '0';
                }
            };

            activeUtterance = utterance;
            synth.speak(utterance);
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingMsg';
            typingDiv.style.cssText = 'display: flex; justify-content: flex-start;';
            typingDiv.innerHTML = '<div style="display: flex; gap: 5px;"><div style="width: 8px; height: 8px; background: #b0a0d8; border-radius: 50%; animation: typing 1.4s infinite;"></div><div style="width: 8px; height: 8px; background: #b0a0d8; border-radius: 50%; animation: typing 1.4s infinite; animation-delay: 0.2s;"></div><div style="width: 8px; height: 8px; background: #b0a0d8; border-radius: 50%; animation: typing 1.4s infinite; animation-delay: 0.4s;"></div></div>';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTyping() {
            const typing = document.getElementById('typingMsg');
            if (typing) typing.remove();
        }

        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        chatSendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        chatTtsBtn.addEventListener('click', () => {
            if (activeUtterance) {
                stopSpeaking();
                return;
            }

            ttsEnabled = !ttsEnabled;
            chatTtsBtn.style.background = ttsEnabled ? 'rgba(102, 126, 234, 0.12)' : 'rgba(239, 68, 68, 0.12)';
            chatTtsBtn.style.borderColor = ttsEnabled ? 'rgba(102, 126, 234, 0.25)' : 'rgba(239, 68, 68, 0.25)';
            chatTtsBtn.style.color = ttsEnabled ? '#4c1d95' : '#7f1d1d';
            chatTtsBtn.title = ttsEnabled ? 'Voice output: ON (click to turn off)' : 'Voice output: OFF (click to turn on)';
            if (!ttsEnabled) stopSpeaking();
        });

        if (chatS2sBtn) {
            chatS2sBtn.addEventListener('click', () => {
                speechToSpeechMode = !speechToSpeechMode;
                chatS2sBtn.style.background = speechToSpeechMode ? 'rgba(59, 130, 246, 0.22)' : 'rgba(59, 130, 246, 0.12)';
                chatS2sBtn.style.borderColor = speechToSpeechMode ? 'rgba(59, 130, 246, 0.45)' : 'rgba(59, 130, 246, 0.25)';
                chatS2sBtn.style.color = speechToSpeechMode ? '#0b1f4b' : '#1e3a8a';
                chatS2sBtn.title = speechToSpeechMode ? 'Speech-to-Speech: ON (click to turn off)' : 'Speech-to-Speech: OFF (click to turn on)';
            });
        }

        chatAccurateBtn.addEventListener('click', () => {
            accurateMode = !accurateMode;
            chatAccurateBtn.style.background = accurateMode ? 'rgba(16, 185, 129, 0.12)' : 'rgba(239, 68, 68, 0.12)';
            chatAccurateBtn.style.borderColor = accurateMode ? 'rgba(16, 185, 129, 0.25)' : 'rgba(239, 68, 68, 0.25)';
            chatAccurateBtn.style.color = accurateMode ? '#065f46' : '#7f1d1d';
            chatAccurateBtn.title = accurateMode ? 'Accurate mode: ON (uses more context)' : 'Accurate mode: OFF (faster)';
        });

        chatFastBtn.addEventListener('click', () => {
            fastMode = !fastMode;
            chatFastBtn.style.background = fastMode ? 'rgba(239, 68, 68, 0.22)' : 'rgba(239, 68, 68, 0.12)';
            chatFastBtn.style.borderColor = fastMode ? 'rgba(239, 68, 68, 0.45)' : 'rgba(239, 68, 68, 0.25)';
            chatFastBtn.style.color = fastMode ? '#7f1d1d' : '#991b1b';
            chatFastBtn.title = fastMode ? 'Fast Mode: ON (ultra-low latency)' : 'Fast Mode: OFF (normal)';
        });

        chatRealtimeBtn.addEventListener('click', () => {
            realtimeMode = !realtimeMode;
            chatRealtimeBtn.style.background = realtimeMode ? 'rgba(59, 130, 246, 0.22)' : 'rgba(59, 130, 246, 0.12)';
            chatRealtimeBtn.style.borderColor = realtimeMode ? 'rgba(59, 130, 246, 0.45)' : 'rgba(59, 130, 246, 0.25)';
            chatRealtimeBtn.style.color = realtimeMode ? '#1e3a8a' : '#1e40af';
            chatRealtimeBtn.title = realtimeMode ? 'Real-time Mode: ON (zero latency)' : 'Real-time Mode: OFF (normal)';
            
            // Initialize WebSocket when enabling real-time mode
            if (realtimeMode) {
                initRealtimeWebSocket();
            } else {
                if (realtimeWs) {
                    realtimeWs.close();
                    realtimeWs = null;
                }
            }
        });

        function initRealtimeWebSocket() {
            if (realtimeWs) return;
            
            realtimeWs = new WebSocket('ws://localhost:8000/ws/realtime-speech');
            
            realtimeWs.onopen = () => {
                console.log('Real-time WebSocket connected');
            };
            
            realtimeWs.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.type === 'transcript') {
                    // Show partial transcript
                    voiceIndicator.style.opacity = '1';
                    voiceIndicator.textContent = `üé§ ${data.text}`;
                } else if (data.type === 'llm_chunk') {
                    // Show streaming response text
                    voiceIndicator.style.opacity = '1';
                    voiceIndicator.textContent = `üß† ${data.text}`;
                } else if (data.type === 'audio_chunk') {
                    // Play audio chunk immediately
                    const audioBlob = base64ToBlob(data.audio, 'audio/mp3');
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play().catch(e => console.error('Audio play error:', e));
                }
            };
            
            realtimeWs.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
            
            realtimeWs.onclose = () => {
                console.log('WebSocket closed');
                realtimeWs = null;
            };
        }

        function base64ToBlob(base64, mimeType) {
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            return new Blob([byteArray], { type: mimeType });
        }

        async function handleWhisperStopAndProcess() {
            isVoiceProcessing = true;
            setMicUiProcessing();

            try {
                const { sampleRate } = whisperRecording;
                const totalLength = whisperPcmChunks.reduce((acc, a) => acc + a.length, 0);
                const merged = new Float32Array(totalLength);
                let offset = 0;
                for (const chunk of whisperPcmChunks) {
                    merged.set(chunk, offset);
                    offset += chunk.length;
                }

                const wavBlob = encodeWav16kMono(merged, sampleRate);
                try {
                    await stopWhisperRecordingAndTranscribe();
                } catch (_) {}

                if (speechToSpeechMode) {
                    const { data } = await postToFirstWorkingS2sMetadataEndpoint(wavBlob, 'en');
                    const transcribedText = (data && (data.transcribed_text || data.transcribedText)) ? String(data.transcribed_text || data.transcribedText).trim() : '';
                    const responseText = (data && (data.response_text || data.responseText)) ? String(data.response_text || data.responseText).trim() : '';

                    if (transcribedText) {
                        appendUserBubble(transcribedText);
                        chatHistory.push({ role: 'user', content: transcribedText });
                        while (chatHistory.length > MAX_HISTORY) chatHistory.shift();
                    }

                    let finalAnswerText = responseText;
                    if (!finalAnswerText && transcribedText) {
                        voiceIndicator.style.opacity = '1';
                        voiceIndicator.textContent = 'üß† Thinking...';
                        try {
                            const { data: chatData } = await postToFirstWorkingEndpoint({
                                message: transcribedText,
                                accurate: accurateMode,
                                history: chatHistory
                            });
                            finalAnswerText = (chatData && chatData.response) ? String(chatData.response).trim() : '';
                        } catch (e) {
                            console.error('Chat fallback error:', e);
                        }
                    }

                    if (finalAnswerText) {
                        await appendBotBubble(finalAnswerText);
                        chatHistory.push({ role: 'assistant', content: finalAnswerText });
                        while (chatHistory.length > MAX_HISTORY) chatHistory.shift();

                        if (ttsEnabled) {
                            try {
                                voiceIndicator.style.opacity = '1';
                                voiceIndicator.textContent = 'üîä Speaking...';
                                await playBackendTts(finalAnswerText);
                            } catch (e) {
                                console.error('Backend TTS error:', e);
                                voiceIndicator.style.opacity = '1';
                                voiceIndicator.innerHTML = '<div style="display: flex; gap: 3px;"><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.1s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.2s;"></div><div style="width: 3px; height: 8px; background: white; border-radius: 2px; animation: waveAnimation 0.8s ease-in-out infinite; animation-delay: 0.3s;"></div></div>';
                                speak(finalAnswerText);
                            }
                        }
                    } else {
                        const errorMsg = document.createElement('div');
                        errorMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
                        errorMsg.innerHTML = `<div style="max-width: 75%; padding: 14px 18px; border-radius: 18px; font-size: 14px; background: linear-gradient(135deg, #fee2e2, #fecaca); color: #7f1d1d; border: 1px solid rgba(239, 68, 68, 0.15); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">Sorry, I couldn't generate an answer. Please check backend logs and browser console.</div>`;
                        chatMessages.appendChild(errorMsg);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        voiceIndicator.style.opacity = '0';
                    }
                } else {
                    const { data } = await postToFirstWorkingSttEndpoint(wavBlob, 'en');
                    const transcript = (data && data.text) ? String(data.text).trim() : '';
                    if (transcript) {
                        chatInput.value = transcript;
                        setTimeout(sendMessage, 300);
                    }
                }
            } catch (e) {
                console.error('Whisper voice processing error:', e);
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = 'display: flex; justify-content: flex-start; animation: slideIn 0.4s ease;';
                const msg = (e && (e.name === 'AbortError'))
                    ? 'Request timed out. Please try again (backend may be slow).'
                    : 'Voice request failed. Please check backend + browser console.';
                errorMsg.innerHTML = `<div style="max-width: 75%; padding: 14px 18px; border-radius: 18px; font-size: 14px; background: linear-gradient(135deg, #fee2e2, #fecaca); color: #7f1d1d; border: 1px solid rgba(239, 68, 68, 0.15); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">${escapeHtml(msg)}</div>`;
                chatMessages.appendChild(errorMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } finally {
                isVoiceProcessing = false;
                setMicUiListening(false);
            }
        }

        if (hasWhisperBrowserSupport) {
            chatMicBtn.addEventListener('pointerdown', async (e) => {
                if (isVoiceProcessing) return;
                e.preventDefault();
                try {
                    if (isListening) return;
                    await startWhisperRecording();
                    isListening = true;
                    setMicUiListening(true);
                    startWhisperStreaming();
                } catch (err) {
                    console.error('Failed to start recording:', err);
                }
            });

            chatMicBtn.addEventListener('pointerup', async (e) => {
                if (!isListening) return;
                e.preventDefault();
                isListening = false;
                stopWhisperStreaming();
                if (speechToSpeechMode) {
                    isVoiceProcessing = true;
                    await finalizeStreamingResponse();
                    isVoiceProcessing = false;
                } else {
                    await handleWhisperStopAndProcess();
                }
            });

            chatMicBtn.addEventListener('pointerleave', async (e) => {
                if (!isListening) return;
                e.preventDefault();
                isListening = false;
                stopWhisperStreaming();
                if (speechToSpeechMode) {
                    isVoiceProcessing = true;
                    await finalizeStreamingResponse();
                    isVoiceProcessing = false;
                } else {
                    await handleWhisperStopAndProcess();
                }
            });
        }

        // Click-to-toggle fallback for SpeechRecognition only
        chatMicBtn.addEventListener('click', () => {
            if (hasWhisperBrowserSupport) return;
            if (!recognition) return;
            if (!isListening) {
                isListening = true;
                setMicUiListening(true);
                recognition.start();
            } else {
                isListening = false;
                setMicUiListening(false);
                recognition.stop();
            }
        });

        if (recognition) {
            recognition.onresult = (event) => {
                let transcript = '';
                let finalTranscript = '';
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const chunk = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += chunk;
                    } else {
                        interimTranscript += chunk;
                    }
                }
                transcript = (finalTranscript + interimTranscript).trim();
                chatInput.value = transcript;

                if (interimTranscript && isListening) {
                    voiceIndicator.style.opacity = '1';
                    voiceIndicator.textContent = `üé§ ${interimTranscript.trim()}`;
                }

                const last = event.results[event.results.length - 1];
                if (last && last.isFinal) {
                    isListening = false;
                    chatMicBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    chatMicBtn.style.animation = 'none';
                    voiceIndicator.style.opacity = '0';
                    setTimeout(sendMessage, 300);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech error:', event.error);
                isListening = false;
                chatMicBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                chatMicBtn.style.animation = 'none';
                voiceIndicator.style.opacity = '0';
            };

            recognition.onend = () => {
                isListening = false;
                chatMicBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                chatMicBtn.style.animation = 'none';
                voiceIndicator.style.opacity = '0';
            };
        }

        // FAQ Accordion
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const item = question.parentElement;
                item.classList.toggle('active');
            });
        });
    </script>
</body>
</html>
